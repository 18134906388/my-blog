<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>云服务器配置 | my-blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/png" href="/my-blog/vue-logo.png">
    <meta name="description" content="My blog by vuepress">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.a3a45612.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.37349bea.js" as="script"><link rel="preload" href="/my-blog/assets/js/3.5a445136.js" as="script"><link rel="preload" href="/my-blog/assets/js/12.d6f64ffe.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.dbbc618a.js"><link rel="prefetch" href="/my-blog/assets/js/11.43d39074.js"><link rel="prefetch" href="/my-blog/assets/js/13.aeef5fb6.js"><link rel="prefetch" href="/my-blog/assets/js/14.597e7790.js"><link rel="prefetch" href="/my-blog/assets/js/15.9a84f640.js"><link rel="prefetch" href="/my-blog/assets/js/16.5e42722a.js"><link rel="prefetch" href="/my-blog/assets/js/17.128fcc78.js"><link rel="prefetch" href="/my-blog/assets/js/18.454c014d.js"><link rel="prefetch" href="/my-blog/assets/js/19.380db6f3.js"><link rel="prefetch" href="/my-blog/assets/js/20.c7c65cec.js"><link rel="prefetch" href="/my-blog/assets/js/21.1daf31de.js"><link rel="prefetch" href="/my-blog/assets/js/22.a4528d32.js"><link rel="prefetch" href="/my-blog/assets/js/23.b0650cb5.js"><link rel="prefetch" href="/my-blog/assets/js/24.0e73c842.js"><link rel="prefetch" href="/my-blog/assets/js/4.06075810.js"><link rel="prefetch" href="/my-blog/assets/js/5.3ec563be.js"><link rel="prefetch" href="/my-blog/assets/js/6.38286e39.js"><link rel="prefetch" href="/my-blog/assets/js/7.a0220bb2.js"><link rel="prefetch" href="/my-blog/assets/js/8.1909ccc6.js"><link rel="prefetch" href="/my-blog/assets/js/9.0fb32e4d.js"><link rel="prefetch" href="/my-blog/assets/js/vendors~docsearch.033b3a51.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.a3a45612.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">my-blog</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div> <a href="https://github.com/18134906388/my-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div> <a href="https://github.com/18134906388/my-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/my-blog/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/my-blog/blog/JS中遇到问题.html" class="sidebar-link">JS中遇到问题</a></li><li><a href="/my-blog/blog/CSS中遇到的问题.html" class="sidebar-link">CSS中遇到的问题</a></li><li><a href="/my-blog/blog/VUE中的一些问题.html" class="sidebar-link">VUE中的一些问题</a></li><li><a href="/my-blog/blog/使用mpvue开发微信小程序遇到的坑.html" class="sidebar-link">小程序</a></li><li><a href="/my-blog/blog/面试遇到的问题.html" class="sidebar-link">面试遇到的问题</a></li><li><a href="/my-blog/blog/MySql问题总结.html" class="sidebar-link">MySql问题总结</a></li><li><a href="/my-blog/blog/云服务器配置.html" class="active sidebar-link">云服务器配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/blog/云服务器配置.html#基本信息" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header"><a href="/my-blog/blog/云服务器配置.html#nginx安装" class="sidebar-link">Nginx安装</a></li><li class="sidebar-sub-header"><a href="/my-blog/blog/云服务器配置.html#ssl配置" class="sidebar-link">SSL配置</a></li><li class="sidebar-sub-header"><a href="/my-blog/blog/云服务器配置.html#mysql安装" class="sidebar-link">MySql安装</a></li></ul></li><li><a href="/my-blog/blog/有趣的JS文章.html" class="sidebar-link">有趣的JS文章</a></li><li><a href="/my-blog/blog/前端培训课件.html" class="sidebar-link">前端培训课件</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术沉淀</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="云服务器配置"><a href="#云服务器配置" class="header-anchor">#</a> 云服务器配置</h1> <h2 id="基本信息"><a href="#基本信息" class="header-anchor">#</a> 基本信息</h2> <p>华为云服务器 镜像信息：CentOS 7.6 64bit with SRIOV</p> <h2 id="nginx安装"><a href="#nginx安装" class="header-anchor">#</a> Nginx安装</h2> <h3 id="下载安装包"><a href="#下载安装包" class="header-anchor">#</a> 下载安装包</h3> <p><code>wget -c http://nginx.org/download/nginx-1.16.0.tar.gz</code> 或拷贝本地安装包</p> <h3 id="解压"><a href="#解压" class="header-anchor">#</a> 解压</h3> <p><code>tar -zxvf nginx-1.16.0.tar.gz</code></p> <h3 id="生成配置文件"><a href="#生成配置文件" class="header-anchor">#</a> 生成配置文件</h3> <p><code>cd nginx-1.16.0</code> <code>./configure</code> 如果在这里报错（./configure: error: the HTTP rewrite module requires the PCRE library.） 先安装<code>yum -y install openssl openssl-devel</code> <code>make -j4 &amp;&amp; make install</code></p> <h3 id="编译安装"><a href="#编译安装" class="header-anchor">#</a> 编译安装</h3> <p><code>make &amp;&amp; make install</code>编译并安装 <code>make</code>单纯使用make是编译，这时会在obj文件夹下面生成新的nginx文件，常用来新增模块。</p> <h3 id="启动nginx"><a href="#启动nginx" class="header-anchor">#</a> 启动nginx</h3> <p><code>cd /usr/local/nginx/sbin/nginx</code></p> <h3 id="修改安全组"><a href="#修改安全组" class="header-anchor">#</a> 修改安全组</h3> <p><img src="/my-blog/assets/img/nginx1.39dafafe.png" alt="函数prototype"></p> <h3 id="查看防火墙状态"><a href="#查看防火墙状态" class="header-anchor">#</a> 查看防火墙状态</h3> <p><code>firewall-cmd --state</code></p> <h3 id="查看所有打开的端口"><a href="#查看所有打开的端口" class="header-anchor">#</a> 查看所有打开的端口</h3> <p><code>firewall-cmd --zone=dmz --list-ports</code></p> <h3 id="配置防火墙"><a href="#配置防火墙" class="header-anchor">#</a> 配置防火墙</h3> <div class="language- extra-class"><pre class="language-text"><code>firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload
firewall-cmd --complete-reload
</code></pre></div><h2 id="ssl配置"><a href="#ssl配置" class="header-anchor">#</a> SSL配置</h2> <h3 id="生成一个key"><a href="#生成一个key" class="header-anchor">#</a> 生成一个key</h3> <p><code>openssl genrsa -des3 -out ssl.key 1024</code></p> <p>然后他会要求你输入这个key文件的密码。不推荐输入。因为以后要给nginx使用。每次reload nginx配置时候都要你验证这个PAM密码的。
由于生成时候必须输入密码。你可以输入后 再删掉。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mv</span> ssl.key xxx.key
openssl rsa -in xxx.key -out ssl.key
<span class="token function">rm</span> xxx.key
</code></pre></div><h3 id="根据这个key文件生成证书请求文件"><a href="#根据这个key文件生成证书请求文件" class="header-anchor">#</a> 根据这个key文件生成证书请求文件</h3> <p><code>openssl req -new -key ssl.key -out ssl.csr</code>
以上命令生成时候要填很多东西 一个个看着写吧（可以随便，毕竟这是自己生成的证书）</p> <h3 id="生成crt证书文件"><a href="#生成crt证书文件" class="header-anchor">#</a> 生成crt证书文件</h3> <p><code>openssl x509 -req -days 365 -in ssl.csr -signkey ssl.key -out ssl.crt</code></p> <p>这里365是证书有效期 推荐3650哈哈。这个大家随意。最后使用到的文件是key和crt文件。</p> <p>如果需要用pfx 可以用以下命令生成</p> <p><code>openssl pkcs12 -export -inkey ssl.key -in ssl.crt -out ssl.pfx</code></p> <h3 id="nginx配置文件的server节点配置"><a href="#nginx配置文件的server节点配置" class="header-anchor">#</a> nginx配置文件的server节点配置</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
<span class="token keyword">listen</span> <span class="token number">443</span><span class="token punctuation">;</span>
<span class="token keyword">server_name</span> bbs<span class="token punctuation">.</span>nau<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$uri</span> <span class="token operator">!</span><span class="token operator">~</span> <span class="token string">&quot;/logging.php$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">)</span>$ <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token operator">/</span>$<span class="token number">1</span> redirect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">ssl</span> on<span class="token punctuation">;</span>
<span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token punctuation">.</span>crt<span class="token punctuation">;</span>
<span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token keyword">ssl_session_timeout</span> <span class="token number">5</span>m<span class="token punctuation">;</span>
<span class="token keyword">ssl_protocols</span> SSLv2 SSLv3 TLSv1<span class="token punctuation">;</span>
<span class="token keyword">ssl_ciphers</span> ALL<span class="token punctuation">:</span><span class="token operator">!</span>ADH<span class="token punctuation">:</span><span class="token operator">!</span>EXPORT56<span class="token punctuation">:</span>RC4<span class="token operator">+</span>RSA<span class="token punctuation">:</span><span class="token operator">+</span>HIGH<span class="token punctuation">:</span><span class="token operator">+</span>MEDIUM<span class="token punctuation">:</span><span class="token operator">+</span>LOW<span class="token punctuation">:</span><span class="token operator">+</span>SSLv2<span class="token punctuation">:</span><span class="token operator">+</span>EXP<span class="token punctuation">;</span>
<span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="mysql安装"><a href="#mysql安装" class="header-anchor">#</a> MySql安装</h2> <h3 id="下载安装包-2"><a href="#下载安装包-2" class="header-anchor">#</a> 下载安装包</h3> <p>https://dev.mysql.com/downloads/mysql/
或者拷贝本地tar包  mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar</p> <h3 id="解压-2"><a href="#解压-2" class="header-anchor">#</a> 解压</h3> <p><code>tar xvf mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar</code></p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <h4 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h4> <p><code>yum install libaio</code></p> <h4 id="安装rpm包"><a href="#安装rpm包" class="header-anchor">#</a> 安装rpm包</h4> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">rpm</span> -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm
<span class="token function">rpm</span> -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm
<span class="token function">rpm</span> -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm
<span class="token function">rpm</span> -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm
</code></pre></div><p>如果报错error: Failed dependencies:</p> <p>mysql-community-common(x86-64) &gt;= 5.7.9 is needed by</p> <p>mysql-community-libs-5.7.28-1.el7.x86_64</p> <p>mariadb-libs is obsoleted by mysql-community-libs-5.7.28-1.el7.x86_64</p> <p>清除yum里所有mysql依赖包再执行安装</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">rpm</span> -qa<span class="token operator">|</span><span class="token function">grep</span> mysql
yum remove mysql-libs
</code></pre></div><h3 id="验证安装状态"><a href="#验证安装状态" class="header-anchor">#</a> 验证安装状态</h3> <div class="language-Shell extra-class"><pre class="language-shell"><code>mysqladmin --version
<span class="token operator">&gt;&gt;</span>mysqladmin  Ver <span class="token number">8.42</span> Distrib <span class="token number">5.7</span>.28, <span class="token keyword">for</span> Linux on x86_64
</code></pre></div><h3 id="mysql-初始化并查看初始临时密码"><a href="#mysql-初始化并查看初始临时密码" class="header-anchor">#</a> Mysql 初始化并查看初始临时密码</h3> <h4 id="mysql服务初始化"><a href="#mysql服务初始化" class="header-anchor">#</a> MySQL服务初始化</h4> <p><code>mysqld --initialize</code></p> <h4 id="查看初始临时密码"><a href="#查看初始临时密码" class="header-anchor">#</a> 查看初始临时密码</h4> <p><code>grep 'temporary password' /var/log/mysqld.log | tail -1</code></p> <h3 id="修改mysql数据库目录的所属用户及其所属组"><a href="#修改mysql数据库目录的所属用户及其所属组" class="header-anchor">#</a> 修改mysql数据库目录的所属用户及其所属组</h3> <p><code>chown -R mysql:mysql /var/lib/mysql</code></p> <h3 id="启动mysql服务"><a href="#启动mysql服务" class="header-anchor">#</a> 启动MySQL服务</h3> <h4 id="查看当前的mysqld服务状态"><a href="#查看当前的mysqld服务状态" class="header-anchor">#</a> 查看当前的mysqld服务状态</h4> <p><code>systemctl status mysqld</code></p> <h4 id="将mysqld服务设置为开机启动"><a href="#将mysqld服务设置为开机启动" class="header-anchor">#</a> 将mysqld服务设置为开机启动</h4> <p><code>systemctl enable mysqld</code></p> <h4 id="启动mysqld服务"><a href="#启动mysqld服务" class="header-anchor">#</a> 启动mysqld服务</h4> <p><code>systemctl start mysqld</code></p> <h3 id="登录mysql修改密码并设置允许远程登陆"><a href="#登录mysql修改密码并设置允许远程登陆" class="header-anchor">#</a> 登录MySQL修改密码并设置允许远程登陆</h3> <div class="language- extra-class"><pre class="language-text"><code>mysql -uroot -p
Enter password:
mysql&gt; set password=password('******');
mysql&gt;use mysql;
mysql&gt;update user set host='%' where user='root';
mysql&gt;flush privileges;
</code></pre></div><h3 id="配置my-cnf"><a href="#配置my-cnf" class="header-anchor">#</a> 配置my.cnf</h3> <h4 id="查看-etc-my-cnf"><a href="#查看-etc-my-cnf" class="header-anchor">#</a> 查看/etc/my.cnf</h4> <p><code>cat /etc/my.cnf</code></p> <h4 id="编辑-etc-my-cnf"><a href="#编辑-etc-my-cnf" class="header-anchor">#</a> 编辑/etc/my.cnf</h4> <p><code>bind-address=0.0.0.0</code></p> <h3 id="查看防火墙状态-2"><a href="#查看防火墙状态-2" class="header-anchor">#</a> 查看防火墙状态</h3> <p><code>firewall-cmd --state</code></p> <h3 id="查看所有打开的端口-2"><a href="#查看所有打开的端口-2" class="header-anchor">#</a> 查看所有打开的端口</h3> <p><code>firewall-cmd --zone=dmz --list-ports</code></p> <h3 id="配置防火墙-2"><a href="#配置防火墙-2" class="header-anchor">#</a> 配置防火墙</h3> <div class="language- extra-class"><pre class="language-text"><code>firewall-cmd --zone=public --add-port=3306/tcp --permanent
firewall-cmd --reload
firewall-cmd --complete-reload
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my-blog/blog/MySql问题总结.html" class="prev">
        MySql问题总结
      </a></span> <span class="next"><a href="/my-blog/blog/有趣的JS文章.html">
        有趣的JS文章
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/my-blog/assets/js/app.37349bea.js" defer></script><script src="/my-blog/assets/js/3.5a445136.js" defer></script><script src="/my-blog/assets/js/12.d6f64ffe.js" defer></script>
  </body>
</html>
